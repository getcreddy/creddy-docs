# Server Setup

This guide covers installing and configuring the Creddy server.

## Installation

### System Install (Recommended)

Install the binary to `/usr/local/bin`:

```bash
curl -fsSL https://get.creddy.dev/install.sh | sudo sh -s -- --to /usr/local/bin
```

### Install as a Daemon

Set up Creddy as a systemd service:

```bash
sudo creddy install --listen 0.0.0.0:8400
```

This automatically:
- Copies the binary to `/usr/local/bin/creddy` (if needed)
- Creates `/var/lib/creddy` for data storage
- Creates `/usr/local/lib/creddy/plugins` for system plugins
- Writes a hardened systemd unit file
- Enables and starts the service

**Options:**

| Flag | Default | Description |
|------|---------|-------------|
| `--listen` | `0.0.0.0:8400` | Address and port to listen on |
| `--data-dir` | `/var/lib/creddy` | Data directory |
| `--agent-inactivity-days` | `0` | Auto-unenroll inactive agents (0 = disabled) |

### Managing the Service

```bash
systemctl status creddy       # Check status
journalctl -u creddy -f       # View logs
sudo systemctl restart creddy # Restart
sudo creddy uninstall         # Remove service
```

---

## Diagnostics

Check your installation:

```bash
creddy which
```

Output:
```
Binary:
  Path:     /usr/local/bin/creddy
  Checksum: a1b2c3d4...

Config:
  → ✓ ~/.config/creddy/config.yaml
    ✗ /etc/creddy/config.yaml

Plugins:
  Search order:
    1. ✓ ~/.local/share/creddy/plugins (user)
    2. ✓ /usr/local/lib/creddy/plugins (system)

Service:
  Unit:     /etc/systemd/system/creddy.service
  ExecStart: /usr/local/bin/creddy server --listen 0.0.0.0:8400 ...
  Status:   active
```

Check version and updates:

```bash
creddy version
creddy version --json  # Machine-readable output
```

---

## Configuration

### Data Directory

The server stores data in `/var/lib/creddy` (or `--data-dir`):

```
/var/lib/creddy/
├── creddy.db        # SQLite database
└── keys/
    └── signing.key  # Ed25519 signing key
```

### Plugin Directory

System plugins are stored in `/usr/local/lib/creddy/plugins`.

User plugins (from `creddy plugin install`) go to `~/.local/share/creddy/plugins`.

The server searches both directories, so you can install plugins either way.

---

## Running Without systemd

### Foreground (Development)

```bash
creddy server --listen 127.0.0.1:8400
```

### Manual Systemd Setup

If you prefer to create the unit file yourself:

```ini
[Unit]
Description=Creddy credential server
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/creddy server --listen 0.0.0.0:8400 --db /var/lib/creddy/creddy.db
Restart=on-failure
RestartSec=5
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=read-only
ReadWritePaths=/var/lib/creddy

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable creddy
sudo systemctl start creddy
```

---

## Health Check

```bash
curl http://localhost:8400/health
```

Returns:
```json
{
  "status": "healthy",
  "version": "v0.0.9"
}
```

---

## Security Considerations

1. **Run behind a reverse proxy** — Use nginx/caddy for TLS termination
2. **Restrict network access** — Firewall the port, only allow trusted agents
3. **Enable agent inactivity cleanup** — `--agent-inactivity-days 30` removes stale enrollments
4. **Keep plugins updated** — `creddy plugin outdated` checks for updates

---

## Next Steps

- [Client Authentication](/docs/authentication) — How agents enroll and authenticate
- [GitHub Integration](/docs/integrations/github) — Configure GitHub App credentials
- [Building Integrations](/docs/integrations/building) — Create custom plugins
